var LaunchDungeons=function(){Game.GetWord=function(e){return"secret"==e?choose(["hidden","secret","mysterious","forgotten","forbidden","lost","sunk","buried","concealed","shrouded","invisible","elder"]):"ruined"==e?choose(["ancient","old","ruined","ravaged","destroyed","collapsed","demolished","burnt","torn-down","shattered","dilapidated","abandoned","crumbling","derelict","decaying"]):"magical"==e?choose(["arcane","magical","mystical","sacred","honed","banished","unholy","holy","demonic","enchanted","necromantic","bewitched","haunted","occult","astral"]):""},Game.DungeonTypes=[],Game.DungeonType=function(e){return this.name=e,this.nameGenerator=function(){return"Mysterious dungeon"},this.roomTypes=[],Game.DungeonTypes[this.name]=this,this},new Game.DungeonType("Factory").nameGenerator=function(){var e="";return e+=Game.GetWord(choose(["secret","ruined","magical"]))+" "+choose(["factory","factories","bakery","bakeries","confectionery","laboratory","research center","chocolate forge","chocolate foundry","manufactory","warehouse","machinery","works","bakeworks","workshop","assembly line"])},new Game.DungeonType("Mine").nameGenerator=function(){var e="";return e+=Game.GetWord(choose(["secret","ruined","magical"]))+" "+choose(["chocolate","chocolate","chocolate","white chocolate","sugar","cacao"])+" "+choose(["mine","mines","pit","pits","quarry","excavation","tunnel","shaft","lode","trench","mountain","vein","cliff","peak","dome","crater","abyss","chasm","hole","burrow"])},new Game.DungeonType("Portal").nameGenerator=function(){var e="";return e+=Game.GetWord(choose(["secret","ruined","magical"]))+" "+choose(["portal","gate","dimension","warpgate","door"])},new Game.DungeonType("Secret zebra level").nameGenerator=function(){var e="";return e+=Game.GetWord(choose(["secret"]))+" "+choose(["zebra level"])};var e=new DungeonGen;e.loadTiles([["wall",[1,0],"join"],["wall corner",[1,0]],["floor",[1,1],"random3"],["tiled floor",[1,2],"join"],["round pillar",[1,4]],["square pillar",[2,4]],["potted plant",[3,4]],["bookshelf",[4,5],"join"],["door",[1,3],"join"],["alt wall",[4,0],"join"],["alt wall corner",[4,0]],["alt floor",[4,1],"random3"],["alt tiled floor",[4,2],"join"],["alt round pillar",[4,4]],["alt square pillar",[5,4]],["alt potted plant",[6,4]],["alt bookshelf",[4,6],"join"],["alt door",[4,3],"join"],["water",[1,5]],["green water",[2,5]],["dark water",[3,5]],["wooden wall",[1,7],"join"],["wooden floor",[1,6],"random3"],["conveyor belt",[4,7],"join"],["entrance",[0,1]],["alt entrance",[0,3]],["exit",[0,2]],["alt exit",[0,4]]]),Game.monsterIconY=10,Game.Monsters=[],Game.Monster=function(e,t,i,s,o,n){for(var a in this.name=e,this.pic=t,this.icon=i,this.level=s,this.stats={},o)this.stats[a]=o[a];this.stats.hpm=this.stats.hp,this.stats.rarity=o.rarity||1,this.loot=n||{},this.boss=0,this.quotes={},Game.Monsters[this.name]=this};var t,i={cookies:{min:1,max:5,prob:.5}},s={cookies:{min:3,max:8,prob:1},gear:{prob:.05}},o={cookies:{min:10,max:50,prob:1},gear:{prob:.2}};for(var n in new Game.Monster("Doughling","doughling",[0,0],1,{hp:5,might:2,guard:2,speed:6,dodge:6,rarity:.7},i),new Game.Monster("Elder doughling","elderDoughling",[1,0],7,{hp:20,might:7,guard:7,speed:4,dodge:4,rarity:.7},s),new Game.Monster("Angry sentient cookie","angrySentientCookie",[5,0],5,{hp:16,might:8,guard:4,speed:5,dodge:5,rarity:1},i),new Game.Monster("Baby sentient cookie","babySentientCookie",[4,0],1,{hp:3,might:1,guard:1,speed:7,dodge:7,rarity:1},i),new Game.Monster("Burnt sentient cookie","burntSentientCookie",[6,0],5,{hp:16,might:12,guard:2,speed:3,dodge:2,rarity:.2},i),new Game.Monster("Raw sentient cookie","rawSentientCookie",[5,0],5,{hp:16,might:6,guard:4,speed:7,dodge:7,rarity:.2},i),new Game.Monster("Sugar bunny","sugarBunny",[8,0],5,{hp:10,might:3,guard:8,speed:12,dodge:9,rarity:.001},{cookies:{min:1e3,max:1e4}}),Game.Monsters["Sugar bunny"].onKill=function(){Game.Win("Follow the white rabbit")},Game.Monsters["Sugar bunny"].AI="flee",new Game.Monster("Crazed kneader","crazedKneader",[0,2],6,{hp:18,might:6,guard:8,speed:3,dodge:2,rarity:.5},s),new Game.Monster("Crazed chip-spurter","crazedDoughSpurter",[0,2],6,{hp:15,might:6,guard:8,speed:5,dodge:3,rarity:.5},s),new Game.Monster("Alarm bot","alarmTurret",[3,2],2,{hp:6,might:3,guard:5,speed:8,dodge:8,rarity:.5},i),new Game.Monster("Chirpy","chirpy",[4,2],3,{hp:7,might:4,guard:6,speed:9,dodge:9,rarity:.01},{cookies:{min:500,max:5e3}}),Game.Monsters.Chirpy.onKill=function(){Game.Win("Chirped out")},Game.Monsters.Chirpy.quotes={fight:"oh, hello <3"},new Game.Monster("Disgruntled worker","disgruntledWorker",[1,2],4,{hp:14,might:5,guard:5,speed:6,dodge:4,rarity:.6},i),new Game.Monster("Disgruntled overseer","disgruntledOverseer",[1,2],7,{hp:22,might:7,guard:5,speed:6,dodge:4,rarity:.5},i),new Game.Monster("Disgruntled cleaning lady","disgruntledCleaningLady",[2,2],4,{hp:13,might:4,guard:5,speed:7,dodge:6,rarity:.3},i),new Game.Monster("Sentient Furnace","sentientFurnace",[0,3],0,{hp:60,might:14,guard:12,speed:4,dodge:0,rarity:1},o),Game.Monsters["Sentient Furnace"].onKill=function(){Game.Win("Getting even with the oven")},Game.Monsters["Sentient Furnace"].AI="static",Game.Monsters["Sentient Furnace"].boss=1,Game.Monsters["Sentient Furnace"].quotes={fight:"YOU ARE NOT READY!",defeat:"OH... BURN."},new Game.Monster("Ascended Baking Pod","ascendedBakingPod",[1,3],0,{hp:60,might:12,guard:14,speed:4,dodge:0,rarity:.7},o),Game.Monsters["Ascended Baking Pod"].onKill=function(){Game.Win("Now this is pod-smashing")},Game.Monsters["Ascended Baking Pod"].AI="static",Game.Monsters["Ascended Baking Pod"].boss=1,Game.Monsters["Ascended Baking Pod"].quotes={fight:"rrrrrrrise.",defeat:"blrglblg."},Game.BossMonsters=[],Game.Monsters)Game.Monsters[n].boss&&Game.BossMonsters.push(Game.Monsters[n]);Game.Entity=function(e,t,i,s,o){for(var n in this.type=e,this.subtype=t||"",this.dungeon=i,this.pic=s||[0,0],this.stats={},o)this.stats[n]=o[n];if(this.x=-1,this.y=-1,this.obstacle=0,this.zIndex=1,"monster"==this.type)for(var n in this.obstacle=1,this.pic=[Game.Monsters[this.subtype].icon[0],Game.Monsters[this.subtype].icon[1]],this.pic[1]+=Game.monsterIconY,this.targets=[],this.stuck=0,this.zIndex=10,this.fighting=0,this.AI=Game.Monsters[this.subtype].AI||"normal",this.onKill=Game.Monsters[this.subtype].onKill||function(){},Game.Monsters[this.subtype].stats)this.stats[n]=Game.Monsters[this.subtype].stats[n];else if("hero"==this.type){for(var n in this.obstacle=1,this.pic=[Game.Heroes[this.subtype].icon[0],Game.Heroes[this.subtype].icon[1]],this.targets=[],this.stuck=0,this.zIndex=100,this.fighting=0,Game.Heroes[this.subtype].stats)this.stats[n]=Game.Heroes[this.subtype].stats[n];var a=Math.max(0,Game.Objects[this.dungeon.type].amount/20-1);this.stats.hpm+=Math.ceil(2*a),this.stats.hp=this.stats.hpm,this.stats.might+=a,this.stats.guard+=a,this.stats.speed+=a,this.stats.dodge+=a}else"item"==this.type?(this.zIndex=5,this.value=0):"destructible"==this.type?(this.obstacle=1,this.life=3,this.zIndex=15,"door"==this.subtype?this.pic=[0,7]:this.pic=[Math.floor(4*Math.random()+2),7],this.onKill=function(){if("random"==this.subtype){var e=Math.round(Math.pow(Math.random(),6)*(10+this.dungeon.level));if(e>0)this.dungeon.AddEntity("item","cookies",this.x,this.y).value=e}}):"special"==this.type&&(this.zIndex=5,this.value="",this.obstacle=1);this.Say=function(e){"monster"==this.type&&Game.Monsters[this.subtype].quotes[e]&&this.dungeon.Log(this.subtype+' : "<span style="color:#f96;">'+choose(Game.Monsters[this.subtype].quotes[e].split("|"))+'</span>"')},this.Draw=function(){var e="?";return e="random"==this.subtype?"clutter":this.subtype,"item"==this.type&&"cookies"==this.subtype&&this.value>0?this.value<2?this.pic=[0,5]:this.value<3?this.pic=[1,5]:this.value<4?this.pic=[2,5]:this.value<6?this.pic=[3,5]:this.value<10?this.pic=[4,5]:this.value<20?this.pic=[5,5]:this.value<30?this.pic=[7,5]:this.value<70?this.pic=[6,5]:this.value<200?this.pic=[8,5]:this.pic=[6,6]:"special"==this.type&&"upgrade"==this.subtype&&(""!=this.value?this.pic=[7,6]:this.pic=[8,6]),'<div class="thing" title="'+e+'" style="z-index:'+(200+this.zIndex)+";left:"+16*this.x+"px;top:"+16*this.y+"px;background-position:"+16*-this.pic[0]+"px "+16*-this.pic[1]+'px;"></div>'},this.Wander=function(){this.targets=[],this.targets.push([-1,0],[1,0],[0,-1],[0,1]),this.Move()},this.GoTo=function(e,t){this.targets=[],this.x<e&&this.targets.push([1,0]),this.x>e&&this.targets.push([-1,0]),this.y<t&&this.targets.push([0,1]),this.y>t&&this.targets.push([0,-1]),this.Move()||(this.targets=[],this.x==e&&this.targets.push([1,0],[-1,0]),this.y==t&&this.targets.push([0,1],[0,-1]),this.Move())},this.Flee=function(e,t){this.targets=[],this.x>e&&this.targets.push([1,0]),this.x<e&&this.targets.push([-1,0]),this.y>t&&this.targets.push([0,1]),this.y<t&&this.targets.push([0,-1]),this.Move()||(this.targets=[],this.x==e&&this.targets.push([1,0],[-1,0]),this.y==t&&this.targets.push([0,1],[0,-1]),this.Move())},this.Move=function(){if(this.targets.length>0){var e=[];if("hero"==this.type)e=this.targets;else for(var t in this.targets){var i=this.targets[t];-1!=this.dungeon.CheckObstacle(this.x+i[0],this.y+i[1])&&e.push([i[0],i[1]])}if(!(e.length>0))return this.stuck+=2,0;var s=choose(e),o=this.dungeon.CheckObstacle(this.x+s[0],this.y+s[1]);return o==this&&(o=0),0==o&&"static"!=this.AI?(this.x+=s[0],this.y+=s[1]):this.stuck+=2,0!=o&&-1!=o&&o.HitBy(this),-1==o?0:("static"==this.AI&&(this.stuck=0),1)}return 0},this.HitBy=function(e){if("destructible"==this.type&&"hero"==e.type)e.stuck=0,this.life--,this.life<=0?(this.onKill&&this.onKill(),this.Destroy()):this.pic=[this.pic[0],this.pic[1]+1];else if("special"==this.type&&"upgrade"==this.subtype)this.obstacle=0,Game.Upgrades[this.value]&&Game.Upgrades[this.value].earn(),this.value="";else if("monster"==this.type&&"hero"==e.type||"hero"==this.type&&"monster"==e.type&&this.stats.hp>0){e.stuck=0;var t="hero"==this.type?e:this,i="hero"==this.type?this:e;this.dungeon.currentOpponent=t,0==t.fighting&&(Game.Heroes[i.subtype].Say("meet "+Game.Monsters[t.subtype].name),this.Say("fight")),0==this.fighting&&(this.fighting=1,e.fighting=1);var s="",o="",n="";"hero"==e.type?o=Game.Heroes[e.subtype].name:"monster"==e.type&&(o=Game.Monsters[e.subtype].name),"hero"==this.type?n=Game.Heroes[this.subtype].name:"monster"==this.type&&(n=Game.Monsters[this.subtype].name),s+=o+" swings at "+n+"!";var a=Math.round(Math.max(1,Math.min(e.stats.might,Math.pow((e.stats.might+2.5)/Math.max(1,this.stats.guard),2)))*(.8+.4*Math.random()+Math.pow(.8*Math.random(),6)));if(Math.random()>e.stats.speed/Math.max(1,this.stats.dodge+2.5)?s+=" "+n+" dodged the attack.":(e.stats.luck&&"hero"==e.type&&Math.random()<.01*e.stats.luck&&(a*=2,s+=" <b>It's a critical!</b>"),s+=" <b>"+a+"</b> damage!",this.stats.hp-=a,this.stats.hp=Math.max(this.stats.hp,0),this.stats.luck&&"hero"==this.type&&0==this.stats.hp&&Math.random()<.01*this.stats.luck&&(this.stats.hp=1,s+=" "+n+" was saved from certain death!")),"hero"==this.type&&(s='<span style="color:#f99;">'+s+"</span>"),""!=s&&this.dungeon.Log(s),this.stats.hp<=0&&(this.dungeon.Log(o+" crushed "+n+"!"),"hero"==this.type&&(Game.Heroes[this.subtype].Say("defeat"),this.dungeon.Log('<span style="color:#f66;">'+Game.Heroes[this.subtype].name+" has been defeated.</span>"),this.dungeon.FailLevel()),"monster"==this.type&&"hero"==e.type)){if(l("monsterSlot"+this.dungeon.id).style.visibility="hidden",this.dungeon.monstersKilledThisRun+=1,Math.random()<.05&&Game.Heroes[e.subtype].Say("win"),Game.Heroes[e.subtype].Say("win against "+Game.Monsters[this.subtype].name),this.Say("defeat"),Game.Monsters[this.subtype].loot){var h=Game.Monsters[this.subtype].loot;if(h.gear&&(!h.gear.prob||(Math.random(),h.gear.prob)),h.cookies&&(!h.cookies.prob||Math.random()<h.cookies.prob))this.dungeon.AddEntity("item","cookies",this.x,this.y).value=Math.round(h.cookies.min+Math.random()*(h.cookies.max-h.cookies.min))}this.onKill&&this.onKill(),this.Destroy()}}},this.Turn=function(){if("monster"==this.type)for(var e=this.GetInitiative(),t=0;t<e;t++)"flee"==this.AI?this.Flee(this.dungeon.heroEntity.x,this.dungeon.heroEntity.y):(this.GoTo(this.dungeon.heroEntity.x,this.dungeon.heroEntity.y),(this.stuck||this.targets.length==[])&&this.Wander());if("monster"!=this.type&&"hero"!=this.type||(this.stuck>0&&this.stuck--,this.stuck=Math.min(10,this.stuck),this.targets=[]),("hero"==this.type||"monster"==this.type)&&0==this.fighting&&this.stats.hp<this.stats.hpm&&this.stats.hp++,"hero"==this.type){var i=this.dungeon.GetEntities(this.x,this.y);for(var t in i)if("item"==i[t].type&&"cookies"==i[t].subtype){var s=i[t],o=Math.ceil(s.value*Game.Objects[this.dungeon.type].amount*50*(1+Math.random()*(this.stats.luck/20)));o>0&&(this.dungeon.Log('<span style="color:#9f9;">Found <b>'+Beautify(o)+"</b> cookie"+(1==o?"":"s")+"!</span>"),this.dungeon.cookiesMadeThisRun+=o,Game.Earn(o)),s.Destroy()}}"hero"==this.type&&(this.fighting=0)},this.Destroy=function(){this.dungeon.entities.splice(this.dungeon.entities.indexOf(this),1)},this.GetInitiative=function(){return randomFloor(this.stats.speed/5*(1/Math.max(1,this.dungeon.heroEntity.stats.speed/5)))}},Game.Dungeons=[],Game.Dungeon=function(t,i){this.type=t,this.id=i,Game.Dungeons[this.id]=this,this.log=[],this.logNew=0,this.name=Game.DungeonTypes[this.type].nameGenerator(),this.hero=null,this.currentOpponent=0,this.level=0,this.auto=1,this.portalPic="",this.cookiesMadeThisRun=0,this.monstersKilledThisRun=0,this.Log=function(e,t){if("string"==typeof e)this.log.unshift(e),this.logNew++;else for(var i in e)this.Log(e[i],1)},this.UpdateLog=function(){this.log=this.log.slice(0,30);var e="";for(var t in this.log)t<this.logNew?e+='<div class="new">'+this.log[t]+"</div>":e+="<div>"+this.log[t]+"</div>";this.logNew=0,l("dungeonLog"+this.id).innerHTML=e},this.entities=[],this.GetEntities=function(e,t){var i=[];for(var s in this.entities)this.entities[s].x==e&&this.entities[s].y==t&&i.push(this.entities[s]);return i},this.AddEntity=function(e,t,i,s){var o=new Game.Entity(e,t,this);return o.x=i,o.y=s,o.dungeon=this,this.entities.push(o),o},this.RemoveEntities=function(e,t){var i=this.GetEntities(e,t);for(var s in i)i[s].Destroy()},this.DrawEntities=function(){var e="";for(var t in this.entities)e+=this.entities[t].Draw();return e},this.CheckObstacle=function(e,t){if(e<0||e>=this.map.w||t<0||t>=this.map.h)return-1;var i=this.GetEntities(e,t);for(var s in i)if(i[s].obstacle)return i[s];return this.map.isObstacle(e,t)?-1:0},this.map={},this.Generate=function(){0==this.level&&(this.name=Game.DungeonTypes[this.type].nameGenerator()),this.entities=[];var t=new e.Map(40,40,Math.random(),{roomSize:10,corridorSize:5,fillRatio:.5,corridorRatio:.3,pillarRatio:.8*Math.random()+.2,waterRatio:Math.random(),branching:Math.ceil(6*Math.random()),sizeVariance:.4});for(r=0;1!=r;)r=t.dig();for(var i in t.finish(),t.doors)this.AddEntity("destructible","door",t.doors[i][0],t.doors[i][1]);for(var i in t.rooms){var s=choose(["alt ","",""]),o={void:s+"void",wall:s+"wall","wall corner":s+"wall corner",floor:s+"tiled floor","floor edges":s+"floor",door:s+"door",water:choose(["water","green water","dark water"]),pillar:choose([s+"wall",s+"round pillar",s+"square pillar",s+"potted plant","conveyor belt"]),entrance:s+"entrance",exit:s+"exit"};Math.random()<.1&&(o["wall corner"]="wooden wall",o.wall="wooden wall",o["floor edges"]="wooden floor",o.pillar="wooden wall"),Math.random()<.1&&(o["wall corner"]=s+"bookshelf",o.wall=s+"bookshelf",o.pillar=s+"bookshelf"),t.assignTiles(t.rooms[i],o)}this.map=t,this.map.str=this.map.getStr();var n=this.map.exit,a=[];for(var h in Game.BossMonsters){(l=Game.BossMonsters[h]).level<=d+this.level&&Math.random()<(l.stats.rarity||1)&&a.push(l.name)}0==a.length&&(a=[choose(Game.BossMonsters).name]),a.length>0&&(this.AddEntity("monster",choose(a),n[0],n[1]),this.map.removeFreeTile(n[0],n[1]));for(i=0;i<Math.ceil(.7*this.map.freeTiles.length);i++){if(-1!=(n=choose(this.map.freeTiles))){var d=this.map.getRoom(n[0],n[1]).gen+1;if(Math.random()<.2){a=[];for(var h in Game.Monsters){var l;0!=(l=Game.Monsters[h]).level&&l.level<=d+this.level&&Math.random()<(l.stats.rarity||1)&&a.push(l.name)}a.length>0&&(this.AddEntity("monster",choose(a),n[0],n[1]),this.map.removeFreeTile(n[0],n[1]))}else{if(Math.random()<.6){var u=Math.round(Math.pow(Math.random(),6)*(10+this.level));if(u>0)this.AddEntity("item","cookies",n[0],n[1]).value=u}else this.AddEntity("destructible","random",n[0],n[1]);this.map.removeFreeTile(n[0],n[1])}}}},this.onTile=-1,this.Draw=function(){var e="",t=-this.hero.x,i=-this.hero.y;e+='<div id="map'+this.id+'" class="map" style="width:144px;height:144px;"><div class="mapContainer" id="mapcontainer'+this.id+'" style="position:absolute;left:'+16*t+"px;top:"+16*i+'px;"><div id="mapitems'+this.id+'"></div>'+this.map.str+"</div></div>",e+='<div style="position:absolute;left:160px;"><a class="control west" onclick="Game.HeroesById['+this.hero.id+'].Move(-1,0);"></a><br><a class="control east" onclick="Game.HeroesById['+this.hero.id+'].Move(1,0);"></a><br><a class="control north" onclick="Game.HeroesById['+this.hero.id+'].Move(0,-1);"></a><br><a class="control south" onclick="Game.HeroesById['+this.hero.id+'].Move(0,1);"></a><br><a class="control middle" onclick="Game.HeroesById['+this.hero.id+'].Move(0,0);"></a><br></div>',e+='<div style="position:absolute;left:304px;bottom:16px;height:100%;"><div class="dungeonName"><a onclick="Game.ObjectsById['+this.id+'].setSpecial(0);">Exit</a> - <span class="title" style="font-size:12px;">'+this.name+"</span> lvl."+(this.level+1)+'</div><div id="heroSlot'+this.id+'" class="mobSlot"><div id="picHero'+this.id+'" class="mobPic"></div><div id="nameHero'+this.id+'" class="title mobName"></div><div class="hpmBar"><div id="hpHero'+this.id+'" class="hpBar"></div></div></div><div id="monsterSlot'+this.id+'" class="mobSlot" style="left:128px;"><div id="picMonster'+this.id+'" class="mobPic"></div><div id="nameMonster'+this.id+'" class="title mobName"></div><div class="hpmBar"><div id="hpMonster'+this.id+'" class="hpBar"></div></div></div></div><div id="dungeonLog'+this.id+'" class="dungeonLog"></div>',l("rowSpecial"+this.id).innerHTML='<div style="width:100%;height:100%;z-index:10000;position:absolute;left:0px;top:0px;">'+e+"</div>",l("picHero"+this.id).style.backgroundImage="url(img/"+this.hero.portrait+".png)",l("nameHero"+this.id).innerHTML=this.hero.name},this.Refresh=function(){l("mapcontainer"+this.id)||this.Draw();var e=4-this.hero.x,t=4-this.hero.y;l("mapcontainer"+this.id).style.left=16*e+"px",l("mapcontainer"+this.id).style.top=16*t+"px",l("mapitems"+this.id).innerHTML=this.DrawEntities()},this.RedrawMap=function(){this.map.str=this.map.getStr(),this.Draw()},this.Turn=function(){for(var e in this.entities)this.entities[e]&&this.entities[e].type&&this.entities[e].Turn();this.currentOpponent?(l("monsterSlot"+this.id).style.visibility="visible",l("hpMonster"+this.id).style.width=Math.round(this.currentOpponent.stats.hp/this.currentOpponent.stats.hpm*100)+"%",l("picMonster"+this.id).style.backgroundImage="url(img/"+Game.Monsters[this.currentOpponent.subtype].pic+".png)",l("nameMonster"+this.id).innerHTML=Game.Monsters[this.currentOpponent.subtype].name,l("picHero"+this.id).style.backgroundImage="url(img/"+this.hero.pic+".png)"):(l("monsterSlot"+this.id).style.visibility="hidden",l("hpMonster"+this.id).style.width="100%",l("picHero"+this.id).style.backgroundImage="url(img/"+this.hero.portrait+".png)"),this.currentOpponent=0,l("hpHero"+this.id).style.width=Math.round(this.heroEntity.stats.hp/this.heroEntity.stats.hpm*100)+"%",this.Refresh(),this.UpdateLog(),this.hero.x==this.map.exit[0]&&this.hero.y==this.map.exit[1]&&this.CompleteLevel()},this.DrawButton=function(){var e="";return e+='<div style="width:144px;height:144px;position:absolute;left:0px;bottom:0px;"><a class="specialButtonPic" style="background-image:url(img/'+this.portalPic+'.png);" onclick="Game.ObjectsById['+this.id+'].setSpecial(1);"><div class="specialButtonText">Enter dungeons</div></a></div>'},this.CompleteLevel=function(){this.hero.Say("completion"),this.level++,this.Generate(),Game.HeroesById[0].EnterDungeon(this,this.map.entrance[0],this.map.entrance[1]),this.Draw()},this.FailLevel=function(){this.Log("Cookies made this run : "+Beautify(this.cookiesMadeThisRun)+" | Monsters defeated this run : "+Beautify(this.monstersKilledThisRun)),this.cookiesMadeThisRun=0,this.monstersKilledThisRun=0,this.level=0,this.Generate(),Game.HeroesById[0].EnterDungeon(this,this.map.entrance[0],this.map.entrance[1]),this.Draw()}},Game.DungeonLocationChain=function(e,t,i){var s=e.getRoom(t,i),o=[];if(-1!=s)for(;s.parent;)o.push(s),s=s.parent;return o.reverse(),o},Game.DungeonLinkLocationChains=function(e,t){if(e.reverse(),t.reverse(),e[0].id==t[0].id)return e[e.length-1];for(var i in t)if(e[0]==t[i].parent)return t[i];return e.length>1?e[1]:e[0]},Game.Objects.Factory.special=function(){this.dungeon=new Game.Dungeon("Factory",this.id),this.dungeon.Generate(),this.specialDrawFunction=function(){this.dungeon.Refresh()},this.drawSpecialButton=function(){return this.dungeon.DrawButton()},this.dungeon.timer=0,this.dungeon.timerWarmup=5,this.dungeon.portalPic="dungeonFactory",this.EachFrame=function(){if(this.dungeon.auto&&(this.dungeon.timer>0&&this.dungeon.timer--,0==this.dungeon.timer)){this.dungeon.timer=Game.fps*(Math.max(.1,2-.2*this.dungeon.hero.stats.speed)+Math.max(this.dungeon.timerWarmup,0)),this.dungeon.timerWarmup>0&&this.dungeon.timerWarmup--;var e=this.dungeon,t=e.heroEntity,i=Game.DungeonLinkLocationChains(Game.DungeonLocationChain(e.map,t.x,t.y),Game.DungeonLocationChain(e.map,e.map.exit[0],e.map.exit[1])),s=0==i.gen||i.id==e.map.getRoom(t.x,t.y).id?[e.map.exit[0],e.map.exit[1]]:i.door;t.GoTo(s[0],s[1]),t.stuck&&t.Wander(),e.hero.x=t.x,e.hero.y=t.y,e.Turn()}},document.addEventListener&&(l("rowSpecial"+this.dungeon.id).removeEventListener("keydown",arguments.callee,!1),l("rowSpecial"+this.dungeon.id).addEventListener("keydown",(function(e){var t=Game.Objects.Factory.dungeon,i=0;37==e.keyCode?(t.hero.Move(-1,0),i=1):38==e.keyCode?(t.hero.Move(0,-1),i=1):39==e.keyCode?(t.hero.Move(1,0),i=1):40==e.keyCode?(t.hero.Move(0,1),i=1):32==e.keyCode?(t.hero.Move(0,0),i=1):65==e.keyCode&&(t.auto?(t.auto=0,t.timerWarmup=-1):(t.auto=1,t.timer=0,t.timerWarmup=0),e.preventDefault()),i&&(e.preventDefault(),t.timer=10*Game.fps,t.timerWarmup=5)})));var e=choose(Game.HeroesById);e.EnterDungeon(this.dungeon,this.dungeon.map.entrance[0],this.dungeon.map.entrance[1])},Game.Heroes=[],Game.HeroesById=[],Game.Hero=function(e,t,i,s){this.name=e,this.pic=t,this.portrait=i,this.icon=s,this.stats={hp:25,hpm:25,might:5,guard:5,speed:5,dodge:5,luck:5},this.dialogue={greeting:"Oh hey.|Sup.",entrance:"Here we go.|So exciting.",completion:"That was easy.|All done here.",defeat:"Welp.|Better luck next time."},this.gear={armor:-1,weapon:-1},this.inDungeon=-1,this.completedDungeons=0,this.x=0,this.y=0,this.EnterDungeon=function(e,t,i){this.inDungeon=e.id,e.hero=this,this.x=t,this.y=i,e.heroEntity=e.AddEntity("hero",e.hero.name,t,i);var s=e.map.getRoom(this.x,this.y);-1!=s&&s.hidden&&(s.hidden=0,e.RedrawMap()),Game.Dungeons[this.inDungeon].Refresh(),e.Log("--------------------"),0==e.level&&this.Say("greeting"),this.Say("entrance"),l("monsterSlot"+e.id).style.visibility="hidden"},this.Move=function(e,t){var i=Game.Dungeons[this.inDungeon];i.heroEntity.targets=[[e,t]],i.heroEntity.Move()&&(this.x=i.heroEntity.x,this.y=i.heroEntity.y,i.Turn())},this.Say=function(e){this.dialogue[e]&&Game.Dungeons[this.inDungeon].Log(this.name+' : "<span style="color:#99f;">'+choose(this.dialogue[e].split("|"))+'</span>"')},this.save=function(){var e="";return e+=this.inDungeon+","+this.completedDungeons+","+this.gear.armor+","+this.gear.weapon},this.load=function(e){var t=e.split(",");this.inDungeon=parseInt(t[0]),this.completedDungeons=parseInt(t[1]),this.gear.armor=parseInt(t[2]),this.gear.weapon=parseInt(t[3])},this.id=Game.HeroesById.length,Game.HeroesById.push(this),Game.Heroes[this.name]=this},(t=new Game.Hero("Chip","girlscoutChip","portraitChip",[1,0])).dialogue={intro:"I'm Chip! I just really like exploring stuff. Let's go have an adventure!",greeting:"Hello there!|I'm ready!|Where are we going today?|Adventure!",win:"Take that!|Hah!|That's right.",entrance:"Chipping in!|Welp, here goes nothing!|I wonder what I'll find!|Hey, this place is new!|This place seems familiar.|Let's make it happen.",completion:"I'm one smart cookie.|Oh yeah!|Let's explore some more!|That was easy!|That sure was fun!|I'm not lost, am I?|More exploring? Sure, why not!",defeat:"B-better luck next time.|That really hurt!|I yield! I yield!|That went badly.|No half-baked excuses next time.|I think I scraped my knee!|Owie.|Woopsie!","win against Sentient Furnace":"The irony, it burns! (...it's funny because it was burning. And made of iron. ...Moving on.)","win against Ascended Baking Pod":"Where is your pod now?|That was disturbing."},t.stats={hp:30,hpm:30,might:5,guard:5,speed:5,dodge:5,luck:5},(t=new Game.Hero("Crumb","girlscoutCrumb","portraitCrumb",[2,0])).dialogue={intro:"I'm Crumb. I look like this because of a baking accident when I was little. Big deal. At least now I don't get hurt as easily as others, I guess.",greeting:"Hi there.|Ready for adventure, I guess.|Reporting for duty.",win:"Oh sorry, did that hurt?|Should have moved out of the way.|Oops. My bad.",entrance:"Let's do this, I guess.|Well, let's go...|I gotta go in there?|Are we really doing this?|I hope I won't get lost like last time.|Let's get this over with.",completion:"I... I did it...|I'm glad that's over.|What, there's more?|In I go, I guess.|It doesn't end, does it?|But it's dark in there.",defeat:"I, uh, ouch.|Why does that always happen to me?|I'm just no good, am I?|Oh no.|I'm... I'm not crying.|Well that wasn't fun at all.|I'm sorry I failed you.|Please... make them go away...","meet Ascended Baking Pod":"That thing shouldn't even be alive.|Is that where they all came from?","win against Ascended Baking Pod":"Hm. Fascinating."},t.stats={hp:25,hpm:25,might:5,guard:7,speed:4,dodge:4,luck:5},(t=new Game.Hero("Doe","girlscoutDoe","portraitDoe",[3,0])).dialogue={intro:"H-hey. Name's Doe. I'm pretty fast. I uh, I promise I'll do my best.",greeting:"H-hey.|Oh, uh, h-hi there.|C-can I join?",win:"Th-that looks like it hurt... awesome...|D-did I do that?|N-neat... there's pieces everywhere.",entrance:"Alright, let's do this!|I-if I really have to.|I-in there? By myself?|...won't you come with me this time?|H-here I go!",completion:"Oh... oh my.|That's... I uh, I'm glad.|Y-yeah that was real easy. Piece of pie!|T-too easy, right?|S-so many cookies...|Ooh? F-fascinating.",defeat:"I-if you can't beat them... join them.|I-it's because I stutter, isn't it?|W-well that's just no good at all.|I, uh, I meant for that to happen.|H-how embarrassing.","meet Ascended Baking Pod":"W-whoah... it's... magnificent...","win against Ascended Baking Pod":"I'm sorry, buddy.|I... I think I hurt it...|Oh no... I-I think I broke it..."},t.stats={hp:25,hpm:25,might:4,guard:4,speed:7,dodge:5,luck:5},(t=new Game.Hero("Lucky","girlscoutLucky","portraitLucky",[4,0])).dialogue={intro:"Oh joy! My name's Lucky. Guess what I'm good at?",greeting:"I'm feeling lucky!|It's a bright day today!|Let's do great things together.",win:"Ooh lucky shot!|Pow! One more.|Damn straight!",entrance:"Glad to be of service!|Oooh this one'll be interesting.|This will be a good one, I can feel it!|Here I come!",completion:"Over already?|Let's explore some more!|That was lucky!|That was no luck, I'm just that good.|Alright, let's move on!|I'm just getting warmed up!",defeat:"I can't believe it!|...This is a joke, right?|Hey! No fair!|B-but...|I'm gonna need a bandaid. And some hot chocolate.|I'll, uh, try again later.|Bad luck! Bad luck!","win against Ascended Baking Pod":"Golly, that was peculiar."},t.stats={hp:25,hpm:25,might:5,guard:4,speed:4,dodge:5,luck:7}};
